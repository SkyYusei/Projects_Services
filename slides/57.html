<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>TheProject.Zone</title>
        <link rel="shortcut icon" type="image/png" href="/static/website/images/favicon.png">
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
        <!-- Latest compiled and minified jQuery -->
        <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
        
    
<link rel="stylesheet" href="/static/student/css/inside.base.css">

    <!-- Warning: this docs.min.css file is not the official file. Due to conflicts, I commented out the first statement (aka body). Use at your own risk. -->
    <link rel="stylesheet" href="/static/student/css/docs.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/student/css/writeup.css">

        
    <script src="/static/student/js/writeup.js"></script>
    <script src="//cdn.jsdelivr.net/jquery.scrollto/2.1.0/jquery.scrollTo.min.js"></script>

    </head>
    <body>
        
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/website/home/"><img height="50" src="/static/website/images/TPZlogo.png"></a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                
                <li><a href="/student/overview/3/">F15-15619 : Cloud Computing </a></li>
                
            </ul>
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/student/gradebook/3/" class="hidden-xs">Gradebook</a>
                    <a href="/student/gradebook/3/" class="visible-xs" data-toggle="collapse" data-target=".navbar-collapse">Gradebook</a>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">ruz@andrew.cmu.edu <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="/website/profile/" class="hidden-xs">Profile</a>
                            <a href="/website/profile/" class="visible-xs" data-toggle="collapse" data-target=".navbar-collapse">Profile</a>
                        </li>
                  </ul>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12 main">
            
                <h1 class="page-header">Phase 2: Handling Complex Read Queries</h1>
                <ul class="nav nav-tabs">
                    
                        
                        <li role="presentation" class="active"><a href="#">Writeup</a></li>
                        
                    
                        
                        <li role="presentation"><a href="/student/submissions/3/57">Submissions</a></li>
                        
                    
                        
                        <li role="presentation"><a href="/student/scoreboard/3/57">Scoreboard</a></li>
                        
                    
                </ul>
            
            <div class="messages">
                
            </div>
        
<div class="progress">
    <div class="progress-bar progress-bar-success"
         role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"/>
    </div>
    
</div>


<button class="btn btn-primary" id="btn_show_password">Show Submission Password</button>
<div id="show-password" style="display:none">
    <ul class="list-group">
      <li class="list-group-item text-right min_height">
        <span class="pull-left">
          <strong>Submission Password</strong>
        </span>KaarQPMXqAEqyJwbUWtcXdldVcBcKkOh</li>
    </ul>
</div>


<div class="writeup">
    <table class="table table-bordered table-striped">
        <tr>
            <th>Module</th>
            <th>Open</th>
            <th>Deadline</th>
        </tr>
        <tr>
            <td>Phase 2: Handling Complex Read Queries</td>
            <td>10/29/2015 00:01 -0400</td>
            <td>11/11/2015 16:59 -0500</td>
        </tr>
    </table>
</div>

<div class="col-md-3" id="leftCol">
    <ul class="nav nav-stacked nav-pills" id="writeup_sidebar">
        
            
                <li><a href="#section_1"><i class="fa fa-li fa-check fa-lg"></i><span>Welcome to Phase 2</span></a></li>
            
        
            
                <li><a href="#section_2"><i class="fa fa-li fa-check fa-lg"></i><span>Query 3</span></a></li>
            
        
            
                <li><a href="#section_3"><i class="fa fa-li fa-check fa-lg"></i><span>Query 4</span></a></li>
            
        
            
                <li><a href="#section_4"><i class="fa fa-li fa-unlock-alt fa-lg"></i><span>Success</span></a></li>
            
        
    </ul>
</div>

<div class="col-md-9" id="mainCol">
    <div id="writeup_sections_container">
        
            
                <div id="section_1" class="writeup_section" data-sequence="1">
                    <div>
      <h1>Twitter Analytics on the Cloud - Phase 2</h1>
      <div>
  <div class="bs-callout bs-callout-learning">
<h4>Learning Objectives</h4>
    <p>This project will encompass the following learning objectives:</p>
    <ol>
      <li>Display working knowledge of the skills developed in this course.</li>
      <li>Design, develop, deploy and optimize fully functional web-servers to handle high loads.</li>
      <li>Implement Extract Transform and Load (ETL) on a large data set (~ 1 TB) and load into MySQL and HBase systems.</li>
      <li>Design and optimize MySQL and HBase databases to deal with scale and improve throughput.</li>
      <li>Evaluate the importance of the storage hierarchy and it's impact on performance.</li>
      <li>Explore and utilize various methods and tools to improve the performance of a complete web service.</li>
      <li>Extend web-servers to handle various queries.</li>
      <li>Develop backend servers to handle range queries.</li>
      <li>Develop fault-tolerant, scalable web-servers to answer live loads.</li>
      <ol>
  </div>
      </div>
    
 <h3>Introduction</h3>
<p>In <a href="./56">Phase 1</a>, you created a basic web service to receive and respond to a high volume of HTTP GET requests for 2 queries. Two versions of your web service were (hopefully) powered by two different back ends- namely MySQL and HBase. In Query 1, you learned how to host a simple concurrent web server that could handle a very insecure authentication scheme. In Query 2, you used both your backend databases as simple key-value stores for large amounts of data. Using them, you could provide a sentiment score for tweets, along with the text of those tweets.
</p>
<p>
In <a href="javascript:alert('This is Phase 2');">Phase 2</a>, the focus is on making you more familiar with connecting to and retrieving data from these two different database systems. You will continue to compare the performance of MySQL and HBase for different query types and different data sizes. You can then decide on an appropriate storage back end for your final system (in the Phase 3 Live Test) to compete against other systems. Your system needs to respond correctly to 4 queries in Phase 2 (including both from Phase 1). Q3 and Q4 are more complex than Q2, and so you will need to read deeply about HBase and MySQL, and for each, leverage the features that can improve their throughput.
</p>
<p>
Your web service should meet the requirements for throughput and cost/hour for queries at a provided workload.
The overall service (development and deployment test period) should cost under a specified budget. Less is generally better, otherwise your competitor will win the contract. Also, you can ONLY use instances in the M family which are smaller than or equal to large for your web service (both your front-end and back-end systems). You should use spot instances for batch jobs and development.
</p>
<div class="bs-callout bs-callout-warning">
    <h4>Resource Tagging And Budgets</h4>
<ol>
<li>Tag all of your instances with <code>Key: 15619project</code> and <code>Value: phase2</code> for all resources</li>
        <li>In addition to the tag above, all instances in your HBase cluster should be tagged with <code>Key: 15619backend</code> and <code>Value: hbase</code>, and all instances with MySQL installed should be tagged with <code>Key: 15619backend</code> and <code>Value: mysql</code>.</li>
        <li>You can use any instances for ETL and debugging.</li>
        <li>You can ONLY use instances in the <strong>M family</strong> which are <strong>smaller than or equal to Large</strong> for your web service (both your front-end and back-end systems).</li>
        <li>You can use any free AMI as your base. You should be building your own AMIs for this project.</li>
        <li>Each run (test submitted to the website) must have a maximum budget of <strong>$1.25 per hour</strong> (include on-demand EC2, storage and ELB costs. Ignore EMR and Network, Disk I/O costs). <strong>Even if you use spot pricing, the constraints that apply pertain to on-demand pricing.</strong></li>
        <li>You will have a budget <strong>$75/team</strong> for all the tasks in this phase including the live test.</li>
</ol>
  </div>

<div class="bs-callout bs-callout-info">
<h4>Grading and Live Tests</h4>
<p>
Phase 2 accounts for 30% of the total grade for this 15619Project. </p>
<p>You will be adding two new queries to your web-service and your performance will be tested with Live Tests on <strong>November 11</strong> both with HBase and MySQL for Q1, Q2, Q3 and Q4. Each database will be tested separately for each query. Live tests for this phase will last 6 hours (3 hours per backend). We have set low rps targets for all 4 queries (compared to previous semesters) to make it easy to attain. </p>
<p><strike>However, to ensure that you focus on both databases, you must score 50% on each version of the query (for instance, if you score 200% on Q3MySQL and 49% on Q3HBase, you will receive 0% on Q3).</strike></p>
<p>
Your grade will be calculated based on your team's performance using both HBase and MySQL as backends.
</p>
<p>A detailed schedule can be seen here. </p>
<h4>Submit DNS for Live Test</h4>
<table class="text-left table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Task</th>
              <th>Description</th>
            </tr>
          </thead>
<tr>
            <td>Before 5:00 pm</td>
            <td>HBase</td>
            <td>Submit your DNS for HBase Live Test before deadline</td>
</tr>
<tr>
            <td>Before 5:00 pm</td>
            <td>Mysql</td>
            <td>Submit your DNS for Mysql Live Test before deadline</td>
</tr>
<tr>
            <td>5:30 pm - 5:31 pm</td>
            <td>HBase DNS Validation</td>
            <td>Validate your HBase DNS. This is the last chance to update your DNS for HBase Live Test</td>
</tr>
<tr>
            <td>5:33 pm - 5:34 pm</td>
            <td>Mysql DNS Validation</td>
            <td>Validate your Mysql DNS. This is the last chance to update your DNS for Mysql Live Test</td>
</tr>
</table>
<h4>HBase Live Test</h4>
<table class="text-left table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Value</th>
              <th>Target</th>
              <th>Weight</th>
            </tr>
          </thead>
 <tr>
<td>6:00 pm - 6:30 pm</td>
            <td>Warm-up (Q1 only)</td>
            <td>-</td>
            <td>0%</td>
          </tr>
           <tr>
            <td>6:30 pm - 7:00 pm</td>
            <td>Q1</td>
            <td>25000</td>
            <td>4%</td>
          </tr>
          <tr>
<td>7:00 pm - 7:30 pm</td>
            <td>Q2</td>
            <td>10000</td>
            <td>8%</td>
          </tr>
<tr>
            <td>7:30 pm - 8:00 pm</td>
            <td>Q3</td>
            <td>5000</td>
            <td>8%</td>
          </tr>
          <tr>
            <td>8:00 pm - 8:30 pm</td>
            <td>Q4</td>
            <td>8000</td>
            <td>8%</td>
          </tr>
        <tr>
            <td>8:30 pm - 9:00 pm</td>
            <td>Mixed Reads(Q1,Q2,Q3,Q4)</td>
            <td>4000/3000/1000/1000</td>
            <td>3+3+3+3 = 12%</td>
          </tr>
        </table>
<h4>MySQL Live Test</h4>
<table class="text-left table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Value</th>
              <th>Target</th>
              <th>Weight</th>
            </tr>
          </thead>
 <tr>
<td>9:00 pm : 9:30 pm</td>
            <td>Warm-up</td>
            <td>-</td>
            <td>0%</td>
          </tr>
           <tr>
<td>9:30 pm - 10:00 pm</td>
            <td>Q1</td>
            <td>25000</td>
            <td>4%</td>
          </tr>
          <tr>
<td>10:00 pm - 10:30 pm</td>
            <td>Q2</td>
            <td>10000</td>
            <td>8%</td>
          </tr>
<tr>
            <td>10:30 pm - 11:00 pm</td>
            <td>Q3</td>
            <td>5000</td>
            <td>8%</td>
          </tr>
          <tr>
            <td>11:00 pm - 11:30 pm</td>
            <td>Q4</td>
            <td>8000</td>
            <td>8%</td>
          </tr>
        <tr>
            <td>11:30 pm : 12:00 am</td>
            <td>Mixed Reads (Q1,Q2,Q3,Q4)</td>
            <td>4000/3000/1000/1000</td>
            <td>3+3+3+3 = 12%</td>
          </tr>
        </table>
<h4>Report</h4>
    <p>A <a href="https://docs.google.com/document/d/1_e8f-CnYAM_g0eMMi2V7WKnXlMZkfx-5qexotVlTKfA/edit?usp=sharing" target="_blank">report</a> which describes your approaches and optimizations needs to be submitted after live tests.</p>

<table class="text-left table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Value</th>
              <th>Weight</th>
            </tr>
          </thead>
 <tr>
<td>November 12, 11:59 pm</td>
            <td>Report</td>
            <td>20%</td>
          </tr>
        </table>
  </div>
<div id="#grading-penalties" class="bs-callout bs-callout-danger">
    <h4 id="project-grading-penalties">Project Grading Penalties</h4>
    <p>The following table outlines the violations of the project rules and their corresponding
      grade penalties for this project.</p>
    <table class="table">
      <thead>
        <tr class="danger">
          <th>Violation</th>
          <th>Penalty of the project grade</th>
        </tr>
      </thead>
      <tbody>
        <tr>
              <td>Using more than $90 to complete this phase</td>
              <td>-10%</td>
            </tr>
 <tr>
              <td>Using more than $1.25 per hour for submissions</td>
              <td>-2*n%(where n is the percentage of exceeded budget. e.g. spending $1.35 per hour will result in 16% penalty)</td>
            </tr>
            <tr>
              <td>Using more than $75 to complete this phase</td>
              <td>-100%</td>
            </tr>
            <tr>
              <td>Publishing your code to public(e.g. Public Repository on Github)</td>
              <td>-200% at least</td>
            </tr>
            <tr>
              <td>Copying code from Internet, other teams or solutions from previous semesters</td>
              <td>-200% at least</td>
            </tr>
            <tr>
              <td>Any kind of collaboration across teams</td>
              <td>-200% at least</td>
            </tr>
      </tbody>
    </table>
  </div>

                </div>
            
        
            
                <div id="section_2" class="writeup_section" data-sequence="2">
                    <h3>Query 3 (Spreading Happiness/Sadness) 
<p> Target Throughput: 5000 rps </p>
<p> Due 16:59 EST, Wed November 11 (one hour before Live Test starts)</p>
</h3>
<p>Given a date range, and a userid, return n tweets each by the user that had the most positive and negative impact on the world, based on the tweet impact score. 
 </p>
<p> For each tweet, a user earns an impact score based on the following formula:</p>
<strong>score=sentiment_score * (1 + followers_count)</strong>

<p>Request format: 
      <p>
      <pre>GET /q3?start_date=yyyy-mm-dd&end_date=yyyy-mm-dd&userid=1234567890&n=7</pre>
      <p>Response format:</p>
<pre>
TEAMID,TEAM_AWS_ACCOUNT_ID<font color="red">\n</font>
Positive Tweets<font color="red">\n</font>
date_pos1,impact_score_pos1,tweetid,censored_tweet_text<font color="red">\n</font>
date_pos2,impact_score_pos2,tweetid,censored_tweet_text<font color="red">\n</font>
...
date_posn,impact_score_posn,tweetid,censored_tweet_text<font color="red">\n</font>
<font color="red">\n</font>
Negative Tweets<font color="red">\n</font>
date_neg1,impact_score_neg1,tweetid,censored_tweet_text<font color="red">\n</font>
date_neg2,impact_score_neg2,tweetid,censored_tweet_text<font color="red">\n</font>
...
date_negn,impact_score_negn,tweetid,censored_tweet_text<font color="red">\n</font>
</pre>
<p>While answering this query, you should keep the following details in mind:</p>
      <ul>
        <li>For the range, start date is inclusive, end date is inclusive.</li>
        <li>Sort order: absolute value of score (descending), resolve ties by tweet id (ascending)</li>
        <li>If the user has fewer than 'n' positive or negative tweets in the date range, return only the qualifying tweets (i.e. less than n rows).</li>
        <li>"Positive impact" tweets must have an impact score greater than zero.</li>
        <li>"Negative impact" tweets must have an impact score less than zero.</li>
        <li><code>n</code> is always less than or equal to 10</li>

      </ul>
 </div>
                </div>
            
        
            
                <div id="section_3" class="writeup_section" data-sequence="3">
                    <h3>Query 4 (Hashtag Analysis) <br> Target Throughput: 8000 rps <br> Due 16:59 PM EST, Wed November 11 (one hour before Live Test starts)</h3>
<p>This query asks for the information about a given hashtag.</p>
<p>We send you a hashtag and a number n , and your service needs to return the top n sorted dates (yyyy-mm-dd) when the given hashtag is used including the following information per date:</p>
      <ul>
        <li>Date</li>
        <li>Count</li>
        <li>List of user ids</li>
        <li>Source tweet of sent hashtag</li>
      </ul>

<p>Request format: 
      <p>
      <pre>GET /q4?hashtag=hashtag&n=number</pre>
      <p>Response format:</p>
      <pre>
TEAMID,TEAM_AWS_ACCOUNT_ID<font color="red">\n</font>
Date:Count:[List of user ids]:SourceTweetText<font color="red">\n</font>
Date2:Count2:[List of user ids 2]:SourceTweetText2<font color="red">\n</font>
...</pre>
 <p>Details are as follows:</p>

<p><strong>Hashtag: </strong>The hashtags can be read from the entities object (not from the text).</p>
<p><strong>Date: </strong>Returned date should be in the following format:yyyy-mm-dd</p>
<p><strong>Count: </strong>Count represents the number of times that the given hashtag is used for this day.</p>
<p><strong>List of user ids: </strong>List of comma separated user ids which are sorted in an ascending order. Note that if a user used the hashtag two times in a day, the user has to be in the list only once, meaning the list should consist of unique user ids.</p>
<p><strong>Source Tweet Text: </strong>Earliest tweet text which used the given hash tag on this day. If there is a tie (two tweets sent at the same time), return the one with the higher alphabetical order.</p>
<p><strong>Sorting days(lines): </strong>Keys for sorting are as follows:
<ul>
        <li><strong>Primary key - count: </strong>Each day should be sorted by count in a descending order. The day with the highest count should be in the first line. In case of a tie, the secondary key must be used. </li>
        <li><strong>Secondary key - date: </strong>If counts are the same, the lines should be sorted by date in an ascending order. The earliest day will come first.</li>
      </ul>
<p>Sample Request</p> 
          <pre>GET /q4?hashtag=00hi9&n=1</pre>
          <p>Sample Response</p>
      <pre>Team,1234-5678-1234<wbr>
2014-04-01:1:2450949730:@SharpeApril http://t.co/v5b5bKn7sZ #00hi9<font color="red">\n</font></p>

                </div>
            
        
            
                <div id="section_4" class="writeup_section" data-sequence="4">
                    <p>Success!</p>

<iframe src="https://docs.google.com/forms/d/1Bzl6i9gUvTNWGILy0z6C1J3aoIzochvb9DsUIQxrr6E/viewform?embedded=true" width="760" height="500" frameborder="0" marginheight="0" marginwidth="0">Loading...</iframe>
                </div>
            
        
        <input type="hidden" id="token" name="token" value="">
        <input type="hidden" id="phase_id" name="phase_id" value="57">
        <input type="hidden" id="username-input" name="username" value="ruz@andrew.cmu.edu">
        
            <input type="hidden" id="quiz_status_url" name="quiz_status_url" value="https://15619project.org/api/v1/quiz_status/">
        
            <input type="hidden" id="answer_url" name="answer_url" value="https://15619project.org/api/v1/send_answer/">
        
            <input type="hidden" id="service_name" name="service_name" value="TPZ">
        
            <input type="hidden" id="question_url" name="question_url" value="https://15619project.org/api/v1/request_question/">
        
            <input type="hidden" id="hint_url" name="hint_url" value="https://15619project.org/api/v1/request_hint/">
        
    </div>
    
</div>

        </div>
    </div>
</div>



<footer class="footer">
    <div class="container-fluid">
        <p class="text-muted">Â©2015 Carnegie Mellon University</p>
    </div>
</footer>

    </body>
</html>